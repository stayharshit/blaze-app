<body>
    {{> mainContainer }}
</body>

<template name="form">
    <div class="task-form-container">
        <form class="task-form">
            <input type="text" name="text" placeholder="Type to add new tasks" />
            <select name="priority" class="priority-select">
                <option value="">Select Priority</option>
                <option value="high">High Priority</option>
                <option value="medium">Medium Priority</option>
                <option value="low">Low Priority</option>
            </select>
            <button type="submit">Add Task</button>
        </form>
    </div>
</template>

<template name="mainContainer">
    <div class="app">
        <header>
            <div class="app-bar">
                <div class="app-header">
                    <h1>ğŸ“ï¸ To Do List {{incompleteCount}}</h1>
                </div>
            </div>
        </header>

        <div class="main">
            {{#if isUserLogged}}
            <div class="user">
                <span class="username">{{getUser.username}}</span>
                <button class="logout-btn" title="Logout">ğŸšª</button>
            </div>

            {{#if showStats}}
            {{> statsWrapper stats=stats}}
            {{/if}}

            {{> form }}

            {{> searchWrapper onSearchCallback=handleSearchCallback}}

            <div class="filter-bar">
                <button id="hide-completed-button" class="filter-btn">
                    {{#if hideCompleted}}
                    ğŸ‘ï¸ Show All
                    {{else}}
                    ğŸ™ˆ Hide Completed
                    {{/if}}
                </button>
                <button id="toggle-stats-button" class="filter-btn">
                    {{#if showStats}}
                    ğŸ“Š Hide Stats
                    {{else}}
                    ğŸ“Š Show Stats
                    {{/if}}
                </button>
                <select id="priority-filter" class="filter-select">
                    <option value="">All Priorities</option>
                    <option value="high">High Priority</option>
                    <option value="medium">Medium Priority</option>
                    <option value="low">Low Priority</option>
                </select>
            </div>

            {{#if isLoading}}
            <div class="loading">
                <div class="spinner"></div>
                <span>Loading tasks...</span>
            </div>
            {{/if}}

            <ul class="tasks">
                {{#each tasks}}
                {{> task}}
                {{/each}}
            </ul>

            {{#if showTaskEditor}}
            {{> taskEditorWrapper task=editingTask onSave=handleTaskSave onCancel=handleTaskCancel}}
            {{/if}}
            {{else}}
            {{> login }}
            {{/if}}
        </div>
    </div>
</template>